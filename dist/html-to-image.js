!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).htmlToImage={})}(this,function(t){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))(function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(u,a)}c((r=r.apply(t,e||[])).next())})}function o(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=a(0),u.throw=a(1),u.return=a(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function i(){return new Promise(function(t){"requestIdleCallback"in window?window.requestIdleCallback(function(){return t()},{timeout:16}):setTimeout(t,0)})}"function"==typeof SuppressedError&&SuppressedError;var u,a=(u=0,function(){return u+=1,"u".concat("0000".concat((Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4)).concat(u)});function c(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(t[n]);return e}var s=null;function l(t){return void 0===t&&(t={}),s||(s=t.includeStyleProperties?t.includeStyleProperties:c(window.getComputedStyle(document.documentElement)))}function f(t,e){var n=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return n?parseFloat(n.replace("px","")):0}function d(t,e){void 0===e&&(e={});var n,r,o,i=e.width||(r=f(n=t,"border-left-width"),o=f(n,"border-right-width"),n.clientWidth+r+o),u=e.height||function(t){var e=f(t,"border-top-width"),n=f(t,"border-bottom-width");return t.clientHeight+e+n}(t);return{width:i,height:u}}var h=16384;function v(t,e){return void 0===e&&(e={}),t.toBlob?new Promise(function(n){t.toBlob(n,e.type?e.type:"image/png",e.quality?e.quality:1)}):new Promise(function(n){for(var r=window.atob(t.toDataURL(e.type?e.type:void 0,e.quality?e.quality:void 0).split(",")[1]),o=r.length,i=new Uint8Array(o),u=0;u<o;u+=1)i[u]=r.charCodeAt(u);n(new Blob([i],{type:e.type?e.type:"image/png"}))})}function m(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){r.decode().then(function(){requestAnimationFrame(function(){return e(r)})})},r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=t})}function p(t){return r(this,void 0,void 0,function(){return o(this,function(e){return[2,Promise.resolve().then(function(){return(new XMLSerializer).serializeToString(t)}).then(encodeURIComponent).then(function(t){return"data:image/svg+xml;charset=utf-8,".concat(t)})]})})}function g(t,e,n){return r(this,void 0,void 0,function(){var r,i,u;return o(this,function(o){return r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),u=document.createElementNS(r,"foreignObject"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(n)),i.setAttribute("viewBox","0 0 ".concat(e," ").concat(n)),u.setAttribute("width","100%"),u.setAttribute("height","100%"),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("externalResourcesRequired","true"),i.appendChild(u),u.appendChild(t),[2,p(i)]})})}var w=function(t,e){if(t instanceof e)return!0;var n=Object.getPrototypeOf(t);return null!==n&&(n.constructor.name===e.name||w(n,e))};function b(t,e,n,r){var o=".".concat(t,":").concat(e),i=n.cssText?function(t){var e=t.getPropertyValue("content");return"".concat(t.cssText," content: '").concat(e.replace(/'|"/g,""),"';")}(n):function(t,e){return l(e).map(function(e){var n=t.getPropertyValue(e),r=t.getPropertyPriority(e);return"".concat(e,": ").concat(n).concat(r?" !important":"",";")}).join(" ")}(n,r);return document.createTextNode("".concat(o,"{").concat(i,"}"))}function y(t,e,n,r){var o=window.getComputedStyle(t,n),i=o.getPropertyValue("content");if(""!==i&&"none"!==i){var u=a();try{e.className="".concat(e.className," ").concat(u)}catch(t){return}var c=document.createElement("style");c.appendChild(b(u,n,o,r)),e.appendChild(c)}}var x="application/font-woff",C="image/jpeg",E={woff:x,woff2:x,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:C,jpeg:C,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function S(t){var e=function(t){var e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return E[e]||""}function T(t){return-1!==t.search(/^(data:)/)}function P(t,e){return"data:".concat(e,";base64,").concat(t)}function R(t,e,n){return r(this,void 0,void 0,function(){var r,i;return o(this,function(o){switch(o.label){case 0:return[4,fetch(t,e)];case 1:if(404===(r=o.sent()).status)throw new Error('Resource "'.concat(r.url,'" not found'));return[4,r.blob()];case 2:return i=o.sent(),[2,new Promise(function(t,e){var o=new FileReader;o.onerror=e,o.onloadend=function(){try{t(n({res:r,result:o.result}))}catch(t){e(t)}},o.readAsDataURL(i)})]}})})}var D={};function N(t,e,n){return r(this,void 0,void 0,function(){var r,i,u,a,c;return o(this,function(o){switch(o.label){case 0:if(r=function(t,e,n){var r=t.replace(/\?.*/,"");return n&&(r=t),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?"[".concat(e,"]").concat(r):r}(t,e,n.includeQueryParams),null!=D[r])return[2,D[r]];n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime()),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,R(t,n.fetchRequestInit,function(t){var n=t.res,r=t.result;return e||(e=n.headers.get("Content-Type")||""),function(t){return t.split(/,/)[1]}(r)})];case 2:return u=o.sent(),i=P(u,e),[3,4];case 3:return a=o.sent(),i=n.imagePlaceholder||"",c="Failed to fetch resource: ".concat(t),a&&(c="string"==typeof a?a:a.message),c&&console.warn(c),[3,4];case 4:return D[r]=i,[2,i]}})})}var k=function(t){function n(e,n){var r=t.call(this,e)||this;return r.reason=n,r.name="CaptureAbortedError",r}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,t),n}(Error);function A(t){var e,n,u;return r(this,void 0,void 0,function(){var r,a,c;return o(this,function(o){switch(o.label){case 0:return t.nonBlocking&&t._context?((r=t._context).nodeCount++,function(t){var e=t._context;if(t.maxNodes&&e&&e.nodeCount>=t.maxNodes)throw new k("Capture aborted: exceeded maximum node limit of ".concat(t.maxNodes),"max_nodes");if(t.timeout&&t._startTime&&Date.now()-t._startTime>=t.timeout)throw new k("Capture aborted: exceeded timeout of ".concat(t.timeout,"ms"),"timeout")}(t),t.onProgress&&r.totalNodes&&t.onProgress(r.nodeCount,r.totalNodes),a=!1,void 0!==t.yieldBudget?Date.now()-(null!==(n=null!==(e=r.lastYieldTime)&&void 0!==e?e:t._startTime)&&void 0!==n?n:Date.now())>=t.yieldBudget&&(a=!0):(c=null!==(u=t.yieldEvery)&&void 0!==u?u:50,r.nodeCount%c===0&&(a=!0)),a?(r.lastYieldTime=Date.now(),[4,i()]):[3,2]):[2];case 1:o.sent(),o.label=2;case 2:return[2]}})})}function L(t,e){return r(this,void 0,void 0,function(){var n,r,i,u;return o(this,function(o){switch(o.label){case 0:if("data:,"===(n=t.toDataURL()))return[2,t.cloneNode(!1)];if(r=t.width,i=t.height,!(r*i>5e5)||!("OffscreenCanvas"in window))return[2,m(n)];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,I(t,e)];case 2:return[2,m(o.sent())];case 3:return u=o.sent(),console.warn("Chunked canvas capture failed, using fallback:",u),[2,m(t.toDataURL())];case 4:return[2]}})})}function I(t,e){return r(this,void 0,void 0,function(){var n,r,u,a,c,s,l,f,d,h,v,m;return o(this,function(o){switch(o.label){case 0:if(n=t.width,r=t.height,!(u=t.getContext("2d")))return[2,t.toDataURL()];if(a=new OffscreenCanvas(n,r),!(c=a.getContext("2d")))return[2,t.toDataURL()];s=256,l=Math.ceil(r/s),f=0,o.label=1;case 1:return f<l?(d=f*s,h=Math.min(s,r-d),v=u.getImageData(0,d,n,h),c.putImageData(v,0,d),(null==e?void 0:e.nonBlocking)&&f%4==3?[4,i()]:[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return f+=1,[3,1];case 4:return[4,a.convertToBlob({type:"image/png"})];case 5:return m=o.sent(),[2,new Promise(function(t,e){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=e,n.readAsDataURL(m)})]}})})}function _(t,e){return r(this,void 0,void 0,function(){var n,r,i,u;return o(this,function(o){switch(o.label){case 0:return t.currentSrc?(n=document.createElement("canvas"),r=n.getContext("2d"),n.width=t.clientWidth,n.height=t.clientHeight,null==r||r.drawImage(t,0,0,n.width,n.height),[2,m(n.toDataURL())]):(i=t.poster,u=S(i),[4,N(i,u,e)]);case 1:return[2,m(o.sent())]}})})}function O(t,e){var n;return r(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),(null===(n=null==t?void 0:t.contentDocument)||void 0===n?void 0:n.body)?[4,F(t.contentDocument.body,e,!0)]:[3,2];case 1:return[2,r.sent()];case 2:return[3,4];case 3:return r.sent(),[3,4];case 4:return[2,t.cloneNode(!1)]}})})}var M=function(t){return null!=t.tagName&&"SLOT"===t.tagName.toUpperCase()},j=function(t){return null!=t.tagName&&"SVG"===t.tagName.toUpperCase()};function B(t,e,n){return w(e,Element)&&(function(t,e,n){var r=e.style;if(r){var o=window.getComputedStyle(t);o.cssText?(r.cssText=o.cssText,r.transformOrigin=o.transformOrigin):l(n).forEach(function(n){var i=o.getPropertyValue(n);if("font-size"===n&&i.endsWith("px")){var u=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i="".concat(u,"px")}w(t,HTMLIFrameElement)&&"display"===n&&"inline"===i&&(i="block"),"d"===n&&e.getAttribute("d")&&(i="path(".concat(e.getAttribute("d"),")")),r.setProperty(n,i,o.getPropertyPriority(n))})}}(t,e,n),function(t,e,n){y(t,e,":before",n),y(t,e,":after",n)}(t,e,n),function(t,e){w(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),w(t,HTMLInputElement)&&e.setAttribute("value",t.value)}(t,e),function(t,e){if(w(t,HTMLSelectElement)){var n=e,r=Array.from(n.children).find(function(e){return t.value===e.getAttribute("value")});r&&r.setAttribute("selected","")}}(t,e)),e}function F(t,e,n){return r(this,void 0,void 0,function(){return o(this,function(i){return n||!e.filter||e.filter(t)?[2,Promise.resolve(t).then(function(t){return function(t,e){return r(this,void 0,void 0,function(){return o(this,function(n){return w(t,HTMLCanvasElement)?[2,L(t,e)]:w(t,HTMLVideoElement)?[2,_(t,e)]:w(t,HTMLIFrameElement)?[2,O(t,e)]:[2,t.cloneNode(j(t))]})})}(t,e)}).then(function(n){return function(t,e,n){var i,u;return r(this,void 0,void 0,function(){var r,a,s,l,f;return o(this,function(o){switch(o.label){case 0:if(j(e))return[2,e];if(r=[],0===(r=M(t)&&t.assignedNodes?c(t.assignedNodes()):w(t,HTMLIFrameElement)&&(null===(i=t.contentDocument)||void 0===i?void 0:i.body)?c(t.contentDocument.body.childNodes):c((null!==(u=t.shadowRoot)&&void 0!==u?u:t).childNodes)).length||w(t,HTMLVideoElement))return[2,e];a=0,s=r,o.label=1;case 1:return a<s.length?(l=s[a],[4,A(n)]):[3,5];case 2:return o.sent(),[4,F(l,n)];case 3:(f=o.sent())&&e.appendChild(f),o.label=4;case 4:return a++,[3,1];case 5:return[2,e]}})})}(t,n,e)}).then(function(n){return B(t,n,e)}).then(function(t){return function(t,e){return r(this,void 0,void 0,function(){var n,r,i,u,a,c,s,l,f,d,h,v,m;return o(this,function(o){switch(o.label){case 0:if(0===(n=t.querySelectorAll?t.querySelectorAll("use"):[]).length)return[2,t];r={},m=0,o.label=1;case 1:return m<n.length?[4,A(e)]:[3,5];case 2:return o.sent(),i=n[m],(u=i.getAttribute("xlink:href"))?(a=t.querySelector(u),c=document.querySelector(u),a||!c||r[u]?[3,4]:(s=r,l=u,[4,F(c,e,!0)])):[3,4];case 3:s[l]=o.sent(),o.label=4;case 4:return m++,[3,1];case 5:if((f=Object.values(r)).length){for(d="http://www.w3.org/1999/xhtml",(h=document.createElementNS(d,"svg")).setAttribute("xmlns",d),h.style.position="absolute",h.style.width="0",h.style.height="0",h.style.overflow="hidden",h.style.display="none",v=document.createElementNS(d,"defs"),h.appendChild(v),m=0;m<f.length;m++)v.appendChild(f[m]);t.appendChild(h)}return[2,t]}})})}(t,e)})]:[2,null]})})}var H=/url\((['"]?)([^'"]+?)\1\)/g,U=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,q=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function V(t,e,n,i,u){return r(this,void 0,void 0,function(){var r,a,c,s;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),r=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;var n=document.implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(o),e&&(r.href=e),o.href=t,o.href}(e,n):e,a=S(e),c=void 0,u?[4,u(r)]:[3,2];case 1:return s=o.sent(),c=P(s,a),[3,4];case 2:return[4,N(r,a,i)];case 3:c=o.sent(),o.label=4;case 4:return[2,t.replace((l=e,f=l.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),new RegExp("(url\\(['\"]?)(".concat(f,")(['\"]?\\))"),"g")),"$1".concat(c,"$3"))];case 5:return o.sent(),[3,6];case 6:return[2,t]}var l,f})})}function Y(t){return-1!==t.search(H)}function z(t,e,n){return r(this,void 0,void 0,function(){var r,i;return o(this,function(o){return Y(t)?(r=function(t,e){var n=e.preferredFontFormat;return n?t.replace(q,function(t){for(;;){var e=U.exec(t)||[],r=e[0],o=e[2];if(!o)return"";if(o===n)return"src: ".concat(r,";")}}):t}(t,n),i=function(t){var e=[];return t.replace(H,function(t,n,r){return e.push(r),t}),e.filter(function(t){return!T(t)})}(r),[2,i.reduce(function(t,r){return t.then(function(t){return V(t,r,e,n)})},Promise.resolve(r))]):[2,t]})})}function W(t){var e,n,u;return r(this,void 0,void 0,function(){var r,a,c;return o(this,function(o){switch(o.label){case 0:return t.nonBlocking&&t._context?((r=t._context).nodeCount++,t.onProgress&&r.totalNodes&&t.onProgress(r.nodeCount,r.totalNodes),a=!1,void 0!==t.yieldBudget?Date.now()-(null!==(n=null!==(e=r.lastYieldTime)&&void 0!==e?e:t._startTime)&&void 0!==n?n:Date.now())>=t.yieldBudget&&(a=!0):(c=null!==(u=t.yieldEvery)&&void 0!==u?u:50,r.nodeCount%c===0&&(a=!0)),a?(r.lastYieldTime=Date.now(),[4,i()]):[3,2]):[2];case 1:o.sent(),o.label=2;case 2:return[2]}})})}function $(t,e,n){var i;return r(this,void 0,void 0,function(){var r,u;return o(this,function(o){switch(o.label){case 0:return(r=null===(i=e.style)||void 0===i?void 0:i.getPropertyValue(t))?[4,z(r,null,n)]:[3,2];case 1:return u=o.sent(),e.style.setProperty(t,u,e.style.getPropertyPriority(t)),[2,!0];case 2:return[2,!1]}})})}function G(t,e){return r(this,void 0,void 0,function(){var n,r;return o(this,function(o){switch(o.label){case 0:return[4,$("background",t,e)];case 1:return o.sent()?[3,3]:[4,$("background-image",t,e)];case 2:o.sent(),o.label=3;case 3:return[4,$("mask",t,e)];case 4:return(r=o.sent())?[3,6]:[4,$("-webkit-mask",t,e)];case 5:r=o.sent(),o.label=6;case 6:return(n=r)?[3,8]:[4,$("mask-image",t,e)];case 7:n=o.sent(),o.label=8;case 8:return n?[3,10]:[4,$("-webkit-mask-image",t,e)];case 9:o.sent(),o.label=10;case 10:return[2]}})})}function J(t,e){return r(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return(n=w(t,HTMLImageElement))&&!T(t.src)||w(t,SVGImageElement)&&!T(t.href.baseVal)?[4,N(r=n?t.src:t.href.baseVal,S(r),e)]:[2];case 1:return i=o.sent(),[4,new Promise(function(r,o){t.onload=r,t.onerror=e.onImageErrorHandler?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{r(e.onImageErrorHandler.apply(e,t))}catch(t){o(t)}}:o;var u=t;u.decode&&(u.decode=r),"lazy"===u.loading&&(u.loading="eager"),n?(t.srcset="",t.src=i):t.href.baseVal=i})];case 2:return o.sent(),[2]}})})}function Q(t,e){return r(this,void 0,void 0,function(){var n,r,i,u;return o(this,function(o){switch(o.label){case 0:n=c(t.childNodes),r=0,i=n,o.label=1;case 1:return r<i.length?(u=i[r],[4,W(e)]):[3,5];case 2:return o.sent(),[4,X(u,e)];case 3:o.sent(),o.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}function X(t,e){return r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return w(t,Element)?[4,G(t,e)]:[3,4];case 1:return n.sent(),[4,J(t,e)];case 2:return n.sent(),[4,Q(t,e)];case 3:n.sent(),n.label=4;case 4:return[2]}})})}function K(t,e){var n,u,a;return r(this,void 0,void 0,function(){var r,c;return o(this,function(o){switch(o.label){case 0:return t.nonBlocking?(e.count++,r=!1,void 0!==t.yieldBudget?Date.now()-(null!==(u=null!==(n=e.lastYieldTime)&&void 0!==n?n:t._startTime)&&void 0!==u?u:Date.now())>=t.yieldBudget&&(r=!0):(c=null!==(a=t.yieldEvery)&&void 0!==a?a:50,e.count%c===0&&(r=!0)),r?(e.lastYieldTime=Date.now(),[4,i()]):[3,2]):[2];case 1:o.sent(),o.label=2;case 2:return[2]}})})}var Z={};function tt(t){return r(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:return null!=(e=Z[t])?[2,e]:[4,fetch(t)];case 1:return[4,r.sent().text()];case 2:return n=r.sent(),e={url:t,cssText:n},Z[t]=e,[2,e]}})})}function et(t,e){return r(this,void 0,void 0,function(){var n,i,u,a,c=this;return o(this,function(s){return n=t.cssText,i=/url\(["']?([^"')]+)["']?\)/g,u=n.match(/url\([^)]+\)/g)||[],a=u.map(function(u){return r(c,void 0,void 0,function(){var r;return o(this,function(o){return(r=u.replace(i,"$1")).startsWith("https://")||(r=new URL(r,t.url).href),[2,R(r,e.fetchRequestInit,function(t){var e=t.result;return n=n.replace(u,"url(".concat(e,")")),[u,e]})]})})}),[2,Promise.all(a).then(function(){return n})]})})}function nt(t){if(null==t)return[];for(var e=[],n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,""),r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){if(null===(u=r.exec(n)))break;e.push(u[0])}n=n.replace(r,"");for(var o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){var u;if(null===(u=o.exec(n))){if(null===(u=i.exec(n)))break;o.lastIndex=i.lastIndex}else i.lastIndex=o.lastIndex;e.push(u[0])}return e}function rt(t,e){return r(this,void 0,void 0,function(){var n,r;return o(this,function(o){return n=[],r=[],t.forEach(function(n){if("cssRules"in n)try{c(n.cssRules||[]).forEach(function(t,o){if(t.type===CSSRule.IMPORT_RULE){var i=o+1,u=tt(t.href).then(function(t){return et(t,e)}).then(function(t){return nt(t).forEach(function(t){try{n.insertRule(t,t.startsWith("@import")?i+=1:n.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})}).catch(function(t){console.error("Error loading remote css",t.toString())});r.push(u)}})}catch(i){var o=t.find(function(t){return null==t.href})||document.styleSheets[0];null!=n.href&&r.push(tt(n.href).then(function(t){return et(t,e)}).then(function(t){return nt(t).forEach(function(t){o.insertRule(t,o.cssRules.length)})}).catch(function(t){console.error("Error loading remote stylesheet",t)})),console.error("Error inlining remote css file",i)}}),[2,Promise.all(r).then(function(){return t.forEach(function(t){if("cssRules"in t)try{c(t.cssRules||[]).forEach(function(t){n.push(t)})}catch(e){console.error("Error while reading CSS rules from ".concat(t.href),e)}}),n})]})})}function ot(t){return t.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return Y(t.style.getPropertyValue("src"))})}function it(t,e){return r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:if(null==t.ownerDocument)throw new Error("Provided element is not within a Document");return[4,rt(c(t.ownerDocument.styleSheets),e)];case 1:return[2,ot(n.sent())]}})})}function ut(t){return t.trim().replace(/["']/g,"")}function at(t,e){var n;return r(this,void 0,void 0,function(){function i(t){return r(this,void 0,void 0,function(){var n,r,c,s;return o(this,function(o){switch(o.label){case 0:return[4,K(e,a)];case 1:o.sent(),(t.style.fontFamily||getComputedStyle(t).fontFamily).split(",").forEach(function(t){u.add(ut(t))}),n=Array.from(t.children),r=0,c=n,o.label=2;case 2:return r<c.length?(s=c[r])instanceof HTMLElement?[4,i(s)]:[3,4]:[3,5];case 3:o.sent(),o.label=4;case 4:return r++,[3,2];case 5:return[2]}})})}var u,a;return o(this,function(r){switch(r.label){case 0:return u=new Set,a={count:0,lastYieldTime:null!==(n=e._startTime)&&void 0!==n?n:Date.now()},[4,i(t)];case 1:return r.sent(),[2,u]}})})}function ct(t,e){return r(this,void 0,void 0,function(){var n,r;return o(this,function(o){switch(o.label){case 0:return[4,it(t,e)];case 1:return n=o.sent(),[4,at(t,e)];case 2:return r=o.sent(),[4,Promise.all(n.filter(function(t){return r.has(ut(t.style.fontFamily))}).map(function(t){var n=t.parentStyleSheet?t.parentStyleSheet.href:null;return z(t.cssText,n,e)}))];case 3:return[2,o.sent().join("\n")]}})})}function st(t,e){return r(this,void 0,void 0,function(){var n,r,i,u,a;return o(this,function(o){switch(o.label){case 0:return null==e.fontEmbedCSS?[3,1]:(r=e.fontEmbedCSS,[3,5]);case 1:return e.skipFonts?(i=null,[3,4]):[3,2];case 2:return[4,ct(t,e)];case 3:i=o.sent(),o.label=4;case 4:r=i,o.label=5;case 5:return(n=r)&&(u=document.createElement("style"),a=document.createTextNode(n),u.appendChild(a),t.firstChild?t.insertBefore(u,t.firstChild):t.appendChild(u)),[2]}})})}function lt(t,e){var r=n({},e);if(e.nonBlocking||e.maxNodes||e.timeout||e.onProgress){var o=ft(t),i=Math.floor(2.5*o);r._context={nodeCount:0,lastYieldTime:Date.now(),totalNodes:i},r._startTime=Date.now()}return r}function ft(t){return t.querySelectorAll("*").length+1}function dt(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){var n,r,i,u,a;return o(this,function(o){switch(o.label){case 0:return n=lt(t,e),function(t,e){if(e.maxNodes){var n=ft(t);if(n>e.maxNodes)throw new k("Capture aborted: DOM has ".concat(n," nodes, exceeds maximum of ").concat(e.maxNodes),"max_nodes")}}(t,n),r=d(t,n),i=r.width,u=r.height,[4,F(t,n,!0)];case 1:return[4,st(a=o.sent(),n)];case 2:return o.sent(),[4,X(a,n)];case 3:return o.sent(),function(t,e){var n=t.style;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width="".concat(e.width,"px")),e.height&&(n.height="".concat(e.height,"px"));var r=e.style;null!=r&&Object.keys(r).forEach(function(t){n[t]=r[t]})}(a,n),[4,g(a,i,u)];case 4:return[2,o.sent()]}})})}function ht(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){var n,r,i,u,a,c,s,l,f;return o(this,function(o){switch(o.label){case 0:return n=d(t,e),r=n.width,i=n.height,[4,dt(t,e)];case 1:return[4,m(o.sent())];case 2:return u=o.sent(),a=document.createElement("canvas"),c=a.getContext("2d"),s=e.pixelRatio||function(){var t,e;try{e=process}catch(t){}var n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),l=e.canvasWidth||r,f=e.canvasHeight||i,a.width=l*s,a.height=f*s,e.skipAutoScale||function(t){(t.width>h||t.height>h)&&(t.width>h&&t.height>h?t.width>t.height?(t.height*=h/t.width,t.width=h):(t.width*=h/t.height,t.height=h):t.width>h?(t.height*=h/t.width,t.width=h):(t.width*=h/t.height,t.height=h))}(a),a.style.width="".concat(l),a.style.height="".concat(f),e.backgroundColor&&(c.fillStyle=e.backgroundColor,c.fillRect(0,0,a.width,a.height)),c.drawImage(u,0,0,a.width,a.height),[2,a]}})})}t.CaptureAbortedError=k,t.getFontEmbedCSS=function(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){var n;return o(this,function(r){return n=lt(t,e),[2,ct(t,n)]})})},t.toBlob=function(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,ht(t,e)];case 1:return[4,v(n.sent())];case 2:return[2,n.sent()]}})})},t.toCanvas=ht,t.toJpeg=function(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,ht(t,e)];case 1:return[2,n.sent().toDataURL("image/jpeg",e.quality||1)]}})})},t.toPixelData=function(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){var n,r,i,u;return o(this,function(o){switch(o.label){case 0:return n=d(t,e),r=n.width,i=n.height,[4,ht(t,e)];case 1:return u=o.sent(),[2,u.getContext("2d").getImageData(0,0,r,i).data]}})})},t.toPng=function(t,e){return void 0===e&&(e={}),r(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,ht(t,e)];case 1:return[2,n.sent().toDataURL()]}})})},t.toSvg=dt});
//# sourceMappingURL=html-to-image.js.map
